<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">  <!-- importa el template de Polymer -->
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"> <!-- importacion de webcomponents -->

<dom-module id="my-view1">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>

<!-- IRON AJAX -->
<!-- aqui se pasan los parametros, el metodo de peticion, el script -->
    <iron-ajax id="ajax"
      auto
      url="http://127.0.0.1:5000/"
      method="GET"
      handle-as="json"
      content-type="application/json"
      on-response="didRespond">
    </iron-ajax>
    <template is="dom-if" if={{is_ready}}>
      <template is="dom-repeat" items="{{json2}}">
        <div on-tap="obtenerMarca">
        <h1 value="{{item.marca}}">{{item.marca}}</h1>
      </div>
    </template>
      </template>

      <template is="dom-if" if={{existe_marca}}>
        <template is="dom-repeat" items="{{submarca_json}}">
          <div on-tap="obtenerSumbmarca">
          <h1 value="{{item}}">{{item}}</h1>
        </div>
      </template>
        </template>

        <template is="dom-if" if={{existe_Submarca}}>
          <template is="dom-repeat" items="{{anio_json}}">
            <div on-tap="obtenerSumbmarca">
            <h1 value="{{item}}">{{item}}</h1>
          </div>
        </template>
          </template>


  </template>

  <script>
  //   <h1>La marca {{item.Nombre.Marca}} tiene los carros {{item.Nombre.Carros}}</h1>
    Polymer({
      is: 'my-view1',
      properties: { //propiedades de Polymer
        items:{
          type: Object, //se puede asignar valores String, bool, int, etc
          notify: true
        },
        json2: {
          type: Object,
          value:[{"marca":[]}],
          notify: true
        },
        is_ready: {
          type: Boolean,
          value:false,
          notify: true
        },
        marca: {
          type: String,
          notify: true
        },
        existe_marca: {
          type: Boolean,
          value: false
        },

          json:{
            type: Object,
            value:[],
            notify: true
          },
          submarca: {
            type: String,
            notify: true
          },
          existe_Submarca: {
            type: Boolean,
            value: false
          },
          submarca_json:{
            type: String,
            value: true
          }
      },
      didRespond: function(event){ //se crea una funcion con un nombre de retorno sugerido *event*
        this.is_ready= true
        this.json=event.detail.response.MARCA
        for (i=0; i<Object.keys(this.json).length ; i++){
          this.json2[i]= {"marca":[Object.keys(this.json)[i]], "submarcas":Object.keys(this.json[Object.keys(this.json)[i]])}
          }
    },
    obtenerMarca: function(event){
      this.marca=event.target.innerText.trim()
      this.existe_marca= true
      this.submarca_json= Object.keys(this.json[this.marca])

    },
    obtenerSumbmarca: function(event){
      this.submarca=event.target.innerText.trim()
      this.existe_Submarca= true
      this.anio_json= Object.keys(this.json[this.marca][this.submarca])
      console.log(this.anio_json)

    }


    ///
  //   didRespond: function(event){ //se crea una funcion con un nombre de retorno sugerido *event*
  //     this.is_ready= true
  //     this.json=event.detail.response.MARCA
  //     for (i=0; i<Object.keys(this.json).length ; i++){
  //       this.json2[i]= {"marca":[Object.keys(this.json)[i]], "submarcas":Object.keys(this.json[Object.keys(this.json)[i]])}
  //       }
  // },
  // obtenerMarca: function(event){
  //   this.marca=event.target.innerText.trim()
  //   this.existe_marca= true
  //   this.submarca_json= Object.keys(this.json[this.marca])
  // }


    });
  </script>
</dom-module>
